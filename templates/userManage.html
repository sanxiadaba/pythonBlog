{% extends "baseManage.html" %}
{% block content %}
    <script>
function delMany(){
				var names=document.getElementsByName("checkbox[]");
                var arr=[]
                bootbox.confirm({
        title: "操作提示",
        message: "是否确定删除文章",
        buttons: {
            cancel: {
                label: '再考虑一下'
            },
            confirm: {
                label: '确定修改'
            }
        },
        callback: function (result) {
            if (result.toString() === "true") {
                for(var x=0;x<names.length;x++){
					if(names[x].checked){//选中的全部加起来
						arr.push(parseInt(names[x].value));//将选中的值添加到一个列表

					}
				}
                for (const w of arr) {

        $.post("/hideArticle",param="articleid="+w.toString(),function (data) {
                    if(data==="1"){
                        return false
                    }
                    else {
                         bootbox.alert({title: "错误提示", message: "删除文章失败，请联系管理员"});
                    }

                })


    }
                $.post("/controlBiaoNum",param="controlBiaoNum="+"1",function (data){
                    if (data==="1"){
                        qingti("删除文章成功")
                bootbox.alert({title: "操作提示", message: "删除文章成功"});
                setTimeout(function (){location.reload()}, 1000)
                    }
                    else {
                        bootbox.alert({title: "操作提示", message: "删除文章失败，请联系管理员"});
                    }

                })





            }
        }

    })



			}
</script>
{#    侧边栏模块#}
    <aside class="col-sm-3 col-md-2 col-lg-2 sidebar">
        <ul class="nav nav-sidebar">
            <li class="active" id="myInfo_1" onclick="changeUserManageModel('myInfo_1')"><a>我的资料</a></li>
        </ul>
        <ul class="nav nav-sidebar">
            <li id="myArticle_1" onclick="changeUserManageModel('myArticle_1')"><a>我的文章</a></li>
            <li id="myComment_1" onclick="changeUserManageModel('myComment_1')"><a>我的评论</a></li>
            <li id="myFavo_1" onclick="changeUserManageModel('myFavo_1')"><a>我的收藏</a></li>
            <li id="myLog_1" onclick="changeUserManageModel('myLog_1')"><a>登录记录</a></li>
            <li id="myCredit_1" onclick="changeUserManageModel('myCredit_1')"><a>积分详情</a></li>
        </ul>
    <ul class="nav nav-sidebar">
            <li id="myContact_1" onclick="changeUserManageModel('myContact_1')"><a>联系管理员</a></li>
        </ul>
    </aside>
{#    我的信息模块#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myInfo" style="display: block">
        <h1 class="page-header">信息总览</h1>
      <div class="row placeholders">
        <div class="col-xs-6 col-sm-3 placeholder">
          <h4>文章</h4>
          <span class="text-muted">{{ myInfo["numOfAllMyArticle"] }} 篇</span> </div>
        <div class="col-xs-6 col-sm-3 placeholder">
          <h4>评论</h4>
          <span class="text-muted">{{ myInfo["numOfALLMyComment"] }} 条</span> </div>
        <div class="col-xs-6 col-sm-3 placeholder">
          <h4>收藏文章</h4>
          <span class="text-muted">{{ myInfo["numOfMyFavoriteArticle"] }} 篇</span> </div>
        <div class="col-xs-6 col-sm-3 placeholder">
          <h4>访问量</h4>
          <span class="text-muted">{{ myInfo["allNumOfAllArticleRead"] }}</span> </div>
      </div>
      <h1 class="page-header">个人信息</h1>
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr> </tr>
          </thead>
          <tbody>
            <tr>
              <td>我的昵称:</td>
                <td><input type="text" id="modifyNickname" class="form-control" value="{{ myInfo["myNickname"] }}"/></td>
                <td><button class="btn btn-primary" onclick="modifyNickname(this,{{ myInfo["myNickname"] }})">保存修改</button></td>
            </tr>
            <tr>
              <td>我的注册邮箱</td>
              <td>{{ myInfo["myEmail"] }}</td>
            </tr>
            <tr>
              <td>用户角色</td>
              <td>{{ myInfo["myRole"] }}</td>
            {% if myInfo["myRole"]=="user" %}
                {% if myInfo["whetherApplyForEditor"]==0 %}
                <td><button class="btn btn-primary" onclick="applyEditor(this)">申请成为编辑</button></td>
                {% else %}
                <td><button class="btn btn-primary" onclick="applyEditor(this)">已申请</button></td>
                {% endif %}
            {% endif %}
            </tr>
            <tr>
              <td>总共积分</td>
              <td>{{ myInfo["restOfMyCredit"] }}</td>
                <td><button class="btn btn-primary">点击查看积分明细</button></td>
            </tr>
            <tr>
              <td>我的qq</td>
                {% if myInfo['myQQ'] =="None" %}
                <td><input type="text" id="modifyQQ" class="form-control" value="QQ信息待完善"/></td>
                {% else %}
                <td><input type="text" id="modifyQQ" class="form-control" value="{{ myInfo["myQQ"] }}"/></td>
                {% endif %}
                <td><button class="btn btn-primary" onclick="modifyQQ(this,'{{ myInfo["myQQ"] }}')">保存修改</button></td>
            </tr>
            <tr>
              <td>我的头像</td>
              <td><img height="150" width="150"  src="/static/img/avatar/{{ myInfo["myAvatar"] }}" style="border-radius: 50%"></td>
            <td><button class="btn btn-primary" onclick="location.href='/uploadUserAvatar'">上传头像</button></td>
            </tr>
          </tbody>
          <tfoot>
            <tr></tr>
          </tfoot>
        </table>
      </div>
    </div>
{#    我的文章#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myArticle" style="display: none">
        <h1 class="page-header">操作</h1>
        <ol class="breadcrumb">
          <li><a href="/prepost">增加文章</a></li>
        </ol>
        <h1 class="page-header">管理 <span class="badge" id="allMyArticleNum">{{ myArticleNum }}</span></h1>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th><span class="glyphicon glyphicon-th-large"></span> <span class="visible-lg">选择</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-file"></span> <span class="visible-lg">编号</span></th>
                <th><span class="glyphicon glyphicon-list"></span> <span class="visible-lg">标题</span></th>
                  <th class="hidden-sm"><span class="glyphicon glyphicon-road"></span> <span class="visible-lg">积分</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-tag"></span> <span class="visible-lg">栏目</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-comment"></span> <span class="visible-lg">评论数</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-time"></span> <span class="visible-lg">阅读数</span></th>
                <th><span class="glyphicon glyphicon-pencil"></span> <span class="visible-lg">创建时间</span></th>
                <th><span class="glyphicon glyphicon-envelope"></span> <span class="visible-lg">其他说明</span></th>
              </tr>
            </thead>
            <tbody>
            {% for article in articleInfo %}
                {% if article[11] ==0 %}
                    {% if loop.index<=everyPageInHou %}
              <tr id="article__{{ article[0] }}" class="index_{{ loop.index }}" style="">
{#              选择#}
                <td class="hidden-sm"><input type="checkbox" class="input-control" name="checkbox[]" value="{{ article[0] }}" /></td>
{#                  编号#}
                  <td>{{ article[0] }}</td>
{#                  标题#}
                <td class="article-title">{{ article[1] | my_truncate(20) }}</td>
{#                  积分#}
                  <td>{{ article[6] }}</td>
{#                  类型、栏目#}
                <td>{{ article_type[article[2] | string] }}</td>
{#                  评论数#}
                  <td class="hidden-sm">{{ article[3] }}</td>
{#                  阅读数#}
                  <td class="hidden-sm">{{ article[4] }}</td>
{#                  创建时间#}
                <td>{{ article[5] }}</td>
{#信息说明#}
                  {% if article[7] == 1 %}
                  <td>该文章是草稿</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                    {% else %}
              {% if article[8] ==0 %}
              <td>等待管理员审核</td>
                    {% else %}
                  {% if article[9]==1 %}
                      <td>文章被管理员隐藏</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">查看</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                      {% else %}
                      {% if article[10]==1 %}
                          <td>文章被推荐</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                          {% else %}
                      <td>文章已发布</td>
                            <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                      {% endif %}
              {% endif %}
              {% endif %}
              {% endif %}

              </tr>
                        {% else %}
                        <tr id="article__{{ article[0] }}" class="index_{{ loop.index }} " style="display: none">
{#              选择#}
                <td class="hidden-sm"><input type="checkbox" class="input-control" name="checkbox[]" value="{{ article[0] }}" /></td>
{#                  编号#}
                  <td>{{ article[0] }}</td>
{#                  标题#}
                <td class="article-title">{{ article[1] | my_truncate(20) }}</td>
{#                  积分#}
                  <td>{{ article[6] }}</td>
{#                  类型、栏目#}
                <td>{{ article_type[article[2] | string] }}</td>
{#                  评论数#}
                  <td class="hidden-sm">{{ article[3] }}</td>
{#                  阅读数#}
                  <td class="hidden-sm">{{ article[4] }}</td>
{#                  创建时间#}
                <td>{{ article[5] }}</td>
{#信息说明#}
                  {% if article[7] == 1 %}
                  <td>该文章是草稿</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                    {% else %}
              {% if article[8] ==0 %}
              <td>等待管理员审核</td>
                    {% else %}
                  {% if article[9]==1 %}
                      <td>文章被管理员隐藏</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">查看</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                      {% else %}
                      {% if article[10]==1 %}
                          <td>文章被推荐</td>
                    <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                          {% else %}
                      <td>文章已发布</td>
                            <td><a onclick="modifyArticle({{ article[0] }})">修改</a> <a rel="6" onclick="hideArticle('{{ article[0] }}')">删除</a></td>
                      {% endif %}
              {% endif %}
              {% endif %}
              {% endif %}

              </tr>
                        {% endif %}
                {% endif %}
            {% endfor %}
            </tbody>
          </table>

        <footer class="message_footer">
          <nav>
            <div class="btn-toolbar operation" role="toolbar">
              <div class="btn-group" role="group"> <a class="btn btn-default" onClick="select()">全选</a> <a class="btn btn-default" onClick="reverse()">反选</a> <a class="btn btn-default" onClick="noselect()">不选</a> </div>
              <div class="btn-group" role="group">
                <button onclick="delMany()" type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="删除全部选中" name="checkbox_delete">删除</button>
              </div>
            </div>
{#              下面的分页标签#}
            <ul class="pagination pagenav">
              <li class="disabled"><a aria-label="Previous"> <span aria-hidden="true">&laquo;</span> </a> </li>
              <li class="active" id="biao_1" onclick="changeManagePage('1', '{{ howManyPage_1 }}','{{ everyPageInHou }}','{{ myArticleNum }}')"><a >1</a></li>
                {% for i in howManyPage %}
              <li id="biao_{{ i }}" onclick="changeManagePage('{{ i }}', '{{ howManyPage_1 }}','{{ everyPageInHou }}','{{ myArticleNum }}')"><a >{{ i }}</a></li>
                {% endfor %}

              <li><a  aria-label="Next"> <span aria-hidden="true">&raquo;</span> </a> </li>
            </ul>
          </nav>
        </footer>
    </div>
{#    我的评论#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myComment" style="display: none">
        <h1 class="page-header">我的评论 <span class="badge" id="allMyCommentNum">{{ allMyCommentNum }}</span></h1>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th><span class="glyphicon glyphicon-list"></span> <span class="visible-lg">内容</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-tag"></span> <span class="visible-lg">评论文章</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-comment"></span> <span class="visible-lg">赞同数</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-time"></span> <span class="visible-lg">反对数</span></th>
                <th><span class="glyphicon glyphicon-pencil"></span> <span class="visible-lg">创建时间</span></th>
              </tr>
            </thead>
            <tbody>
            {% for comment in myComment %}
              <tr id="comment__{{ comment[5]}}"  style="">
{#                  内容#}
                <td class="article-title" onclick="tiaoArticle({{ comment[3] }})" >{{ comment[0] }}</td>
{#                  目标文章#}
                <td onclick="tiaoArticle({{ comment[3] }})">{{ comment[5] }}</td>
{#                  赞同数#}
                  <td class="hidden-sm">{{ comment[1] }}</td>
{#                  反对数#}
                  <td class="hidden-sm">{{ comment[2] }}</td>
{#                  创建时间#}
                <td>{{ comment[4] }}</td>
              <td> <a rel="6" onclick="hideComment_1({{ comment[5] }})" >删除</a></td>
              </tr>

            {% endfor %}
            </tbody>
          </table>


    </div>
{#    我的喜欢文章#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myFavo" style="display: none"></div>
{#    我的登陆记录#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myLog" style="display: none"></div>
{#    我的积分明细#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myCredit" style="display: none"></div>
{#    联系管理员#}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="myContact" style="display: none"></div>
{% endblock %}

