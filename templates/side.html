<style>
    .guding {
    position: sticky;
    top: 0;
    {#background-color: green;#}
    {#border: 2px solid #4CAF50;#}
}

</style>
<div class="col-lg-3 col-sm-12" style="border: none;padding-right: 0;padding-top: 13px">

    <div class="col-12 search-bar form-group row">
        <div class="col-8">
            <input type="text" class="form-control" id="keyword" placeholder="请输入关键字" onkeyup="dosearch(event)"/>
        </div>
        <div class="col-4" style="text-align:right;">
            <button type="button" class="btn btn-primary" onclick="dosearch(null)">搜索</button>
        </div>
    </div>

    {# 推荐#}
    <div class="col-12 side">
        <div class="tip">最新文章</div>
        <ul id="last"></ul>
    </div>

    <div class="col-12 side" >
        <div class="tip">最多阅读</div>
        <ul id="most"></ul>
    </div>

    <div class="col-12 side guding" >
        <div class="tip">特别推荐</div>
        <ul id="recommmended">
{#            python的过滤器也可以这样做#}
{#            {{ article_type["1"] | my_truncate(1) }}#}
        </ul>
    </div>

</div>

<script type="text/javascript">
{#    这里定义搜索函数#}
    function dosearch(e) {
        if (e != null && e.keyCode != 13) {
            return false
        }
        var keyword = $.trim($("#keyword").val());
        if (keyword.length === 0 || keyword.length > 10 || keyword.indexOf("%") >= 0) {
            bootbox.alert({"title": "错误提示", "message": "你输入的关键字不合法"});
            $("#keyword").focus();
            return false
        }
        location.href = "/search/1-" + keyword;
    }

    //利用js截取字符串 自定义函数
    function truncate(headline, length) {
        var count = 1;
        var output = "";
        for (var i in headline) {
            output += headline.charAt(i);
            var code = headline.charCodeAt(i);
            if (code <= 128) {
                count += 0.5;
            } else {
                count += 1;
            }
            if (count > length) {
                break;
            }
        }
        return output + "..."

    }


    // 文档加载后开始执行 不需要触发
    $(document).ready(function () {
        //    第一步 发送Ajax请求/recommended 获取json
        $.get("/recommended", function (data) {
            //    获取响应，并动态填充到相应的推荐位置
            var lastData = data[0];
            var mostData = data[1];
            var recommendedData = data[2];

            for (var i in lastData) {
                var articleid = lastData[i][0]
                var headline = lastData[i][1]
                var id = parseInt(i) + 1
                $("#last").append('<li><a href="/article/' + articleid + '">' + (id) + '. ' + truncate(headline, 14) + '</a></li>')
            }

            for (var i in mostData) {
                var articleid = mostData[i][0]
                var headline = mostData[i][1]
                var id = parseInt(i) + 1
                $("#most").append('<li><a href="/article/' + articleid + '">' + (id) + '. ' + truncate(headline, 14) + '</a></li>')
            }

            for (var i in recommendedData) {
                var articleid = recommendedData[i][0]
                var headline = recommendedData[i][1]
                var id = parseInt(i) + 1
                $("#recommmended").append('<li><a href="/article/' + articleid + '">' + (id) + '. ' + truncate(headline, 14) + '</a></li>')
            }


        })
    });
</script>